From 391bff8282b78a8302198a292b2c686b75096dd5 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Tue, 15 Oct 2019 10:01:05 -0700
Subject: [PATCH] python 2 to 3 conversion

---
 tools/fio_jsonplus_clat2csv     |  2 +-
 tools/fiologparser.py           |  7 ++++---
 tools/hist/fiologparser_hist.py | 18 +++++++++---------
 tools/plot/fio2gnuplot          |  2 +-
 4 files changed, 15 insertions(+), 14 deletions(-)

diff --git a/tools/fio_jsonplus_clat2csv b/tools/fio_jsonplus_clat2csv
index 78a007e..c22cd9e 100755
--- a/tools/fio_jsonplus_clat2csv
+++ b/tools/fio_jsonplus_clat2csv
@@ -1,4 +1,4 @@
-#!/usr/bin/python2.7
+#!/usr/bin/python
 # Note: this script is python2 and python3 compatible.
 #
 # fio_jsonplus_clat2csv
diff --git a/tools/fiologparser.py b/tools/fiologparser.py
index cc29f1c..16fb595 100755
--- a/tools/fiologparser.py
+++ b/tools/fiologparser.py
@@ -1,4 +1,4 @@
-#!/usr/bin/python2.7
+#!/usr/bin/python
 # Note: this script is python2 and python 3 compatible.
 #
 # fiologparser.py
@@ -14,10 +14,11 @@
 #
 # to see per-interval average completion latency.
 
-from __future__ import absolute_import
-from __future__ import print_function
+
+
 import argparse
 import math
+from functools import reduce
 
 def parse_args():
     parser = argparse.ArgumentParser()
diff --git a/tools/hist/fiologparser_hist.py b/tools/hist/fiologparser_hist.py
index 8910d5f..982b8bf 100755
--- a/tools/hist/fiologparser_hist.py
+++ b/tools/hist/fiologparser_hist.py
@@ -1,4 +1,4 @@
-#!/usr/bin/python2.7
+#!/usr/bin/python
 """ 
     Utility for converting *_clat_hist* files generated by fio into latency statistics.
     
@@ -124,7 +124,7 @@ def gen_output_columns(ctx):
         columns = ["end-time", "dir", "samples", "min", "avg", "median"]
     else:
         columns = ["end-time", "samples", "min", "avg", "median"]
-    columns.extend(list(map(lambda x: x+'%', strpercs)))
+    columns.extend(list([x+'%' for x in strpercs]))
     columns.append("max")
 
 def fmt_float_list(ctx, num=1):
@@ -180,7 +180,7 @@ def histogram_generator(ctx, fps, sz):
                 raise(e)
 
     # Initial histograms from disk:
-    arrs = {fp: read_chunk(rdr, sz) for fp,rdr in rdrs.items()}
+    arrs = {fp: read_chunk(rdr, sz) for fp,rdr in list(rdrs.items())}
     while True:
 
         try:
@@ -254,7 +254,7 @@ def print_all_stats(ctx, end, mn, ss_cnt, vs, ws, mx, dir=dir):
         # max and min are decimal values if no divisor
         fmt = fmt + "%d, " + fmt_float_list(ctx, len(percs)+1) + ", %d"
 
-    print (fmt % tuple(row))
+    print((fmt % tuple(row)))
 
 def update_extreme(val, fncn, new_val):
     """ Calculate min / max in the presence of None values """
@@ -338,8 +338,8 @@ def guess_max_from_bins(ctx, hist_cols):
         bins = [ctx.group_nr * (1 << 6)]
     else:
         bins = [1216,1280,1344,1408,1472,1536,1600,1664]
-    coarses = range(max_coarse + 1)
-    fncn = lambda z: list(map(lambda x: z/2**x if z % 2**x == 0 else -10, coarses))
+    coarses = list(range(max_coarse + 1))
+    fncn = lambda z: list([z/2**x if z % 2**x == 0 else -10 for x in coarses])
     
     arr = np.transpose(list(map(fncn, bins)))
     idx = np.where(arr == hist_cols)
@@ -367,7 +367,7 @@ def output_weighted_interval_data(ctx,printdirs):
     fps = [open(f, 'r') for f in ctx.FILE]
     gen = histogram_generator(ctx, fps, ctx.buff_size)
 
-    print(', '.join(columns))
+    print((', '.join(columns)))
 
     try:
         start, end = 0, ctx.interval
@@ -412,7 +412,7 @@ def output_weighted_interval_data(ctx,printdirs):
 def output_interval_data(ctx,directions):
     fps = [HistFileRdr(f) for f in ctx.FILE]
 
-    print(', '.join(columns))
+    print((', '.join(columns)))
 
     start = 0
     end = ctx.interval
@@ -473,7 +473,7 @@ def main(ctx):
         try:
             from configparser import SafeConfigParser, NoOptionError
         except ImportError:
-            from ConfigParser import SafeConfigParser, NoOptionError
+            from configparser import SafeConfigParser, NoOptionError
 
         cp = SafeConfigParser(allow_no_value=True)
         with open(ctx.job_file, 'r') as fp:
diff --git a/tools/plot/fio2gnuplot b/tools/plot/fio2gnuplot
index cc4ea4c..9751500 100755
--- a/tools/plot/fio2gnuplot
+++ b/tools/plot/fio2gnuplot
@@ -1,4 +1,4 @@
-#!/usr/bin/python2.7
+#!/usr/bin/python
 # Note: this script is python2 and python3 compatible.
 #
 #  Copyright (C) 2013 eNovance SAS <licensing@enovance.com>
-- 
2.24.0

